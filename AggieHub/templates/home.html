

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aggie Bridge</title>
    {% load static %}
    <link rel="stylesheet" href={% static 'css/homepage.css' %}>
    {% comment %} <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css"> {% endcomment %}
    <script type="text/javascript" src="{% static 'js/jquery-3.6.3.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/home.js' %}"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js'></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    {% comment %} <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css"/>
    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script> {% endcomment %}
    <script src="https://kit.fontawesome.com/b12f80ab13.js" crossorigin="anonymous"></script>
    {% comment %} <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js" integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script> {% endcomment %}
    <script>
        //LOAD TERMS AND PROFILE DATA
        var course_sections;
        //var color;
        
        $(document).ready(function() {
            var new_terms = $("#select_term");
            $.ajax({
                type: "POST",
                url: "{% url 'get_terms' %}",
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (response) {
                    var terms = response.terms;
                    var p_term = response.p_term;
                    html = '';

                    $.each(terms, function(index, value) {
                        if (!(value.includes("(View only)"))) {
                        html = '<option value="' + p_term[index] + '">' + value + '</option>';
                        new_terms.append(html);
                        }
                    });
                }
            });

            $.ajax ({
                type: "POST",
                url: "{% url 'get_profile' %}",
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (response) {
                    var student_name = $("#student_name");
                    var classification = $("#classification");
                    student_name.html(response.first + ' ' + response.last);
                    classification.html(response.classification);
                }
            });

            /*
            dialog = $("#schedule-dialog").dialog({
                autoOpen: false,
                resizable: false,
                height: "auto",
                width: 400,
                modal: true,
                buttons: {
                    "Save Changes": function() {
                        color = $("#color").val();
                        $(this).dialog("close");
                    },
                    Cancel: function() {
                        $(this).dialog("close");
                    }
                }
            });

            Coloris({
                el: '.coloris',
                theme: 'polaroid',
                themeMode: 'auto', // light, dark, auto
                swatches: [
                '#264653',
                '#2a9d8f',
                '#e9c46a',
                '#f4a261',
                '#e76f51',
                '#d62828',
                '#023e8a',
                '#0077b6',
                '#0096c7',
                '#00b4d8',
                '#48cae4',
                ],
            });
            */
        })

        //CLEAR SCHEDULE AND SELECTIONS ON TERM CHANGE - FIXME
        {% comment %} $(document).ready(function(){
            //when user focuses on term dropdown, check if there is a schedule in progress
            $("#select_term").focus(function(){
                $("#select_term").blur();
                if ($('#details').length > 1) {
                    var answer = confirm("Changing the term will clear your current selections. Are you sure you want to change the term?");
                    if (answer == true) {
                        clearSchedule();
                        $("#select_term").blur();
                    } else {
                        $("#select_term").blur();
                    }
                }
            });
        }); {% endcomment %}

        //REGISTER SCHEDULE
        $(document).ready(function(){
           $("#register").click(function() {
            var result = register();
            console.log(result);
            $.ajax ({

                type: "POST",
                url: "{% url 'register_student' %}",
                data: {
                    'schedule': JSON.stringify(result),
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        alert("Schedule successfully registered!");
                    } else {
                        alert("Schedule could not be registered.");
                    }
                }
            })
           });
        });

        //LOAD SUBJECTS
        $(document).ready(function(){
            clearSelection();
            $("#available").empty();
            $("#description").hide();
            $("#add").hide();
            $("#select_term").change(function(){
                var term = $(this).children("option:selected").text();                
                $.ajax({
                    type: "POST",
                    url: "{% url 'get_subjects' %}",
                    data: {
                        'term': term,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (response) {
                        var all_sections = $("#available");
                        all_sections.empty();
                        var course_select = $("#select_course");
                        var subject_select = $("#select_subject");
                        course_select.empty();
                        course_select.append('<option disabled hidden selected>Select Course</option>');
                        subject_select.empty();
                        subject_select.append('<option disabled hidden selected>Select Subject</option>');
                        var subjects = response;
                        html = '';
                        $.each(subjects, function(index, value) {
                            for (var i = 0; i < value.length; i++) {
                                html = '<option value="' + value[i] + '">' + value[i] + '</option>';
                                subject_select.append(html);
                            }
                        });
                    }
                }); 
            });
        });
        
        //LOAD COURSES
        $(document).ready(function(){
            $("#select_subject").change(function(){
                clearSelection();
                $("#available").empty();
                $("#description").hide();
                $("#add").hide();

                var subject = $(this).children("option:selected").val();
                $.ajax({
                    type: "POST",
                    url: "{% url 'get_courses' %}",
                    data: {
                        'subject': subject,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (response) {
                        var courses = response;
                        var all_sections = $("#available");
                        all_sections.empty();
                        var course_select = $("#select_course");
                        course_select.empty();
                        course_select.append('<option disabled hidden selected>Select Course</option>');
                        html = '';
                        //display course id - course name in dropdown
                        var course_ids = courses.course_id;
                        var course_names = courses.course_name;
                        
                        $.each(course_ids, function(index, value) {
                            html = '<option value="' + course_ids[index] + '">' + course_ids[index] + ' - ' + course_names[index] + '</option>';
                            course_select.append(html);
                        });
                    }
                });
            });
        });
        
        //LOAD SECTIONS
        $(document).ready(function(){
            $("#select_course").change(function(){
                clearSelection();
                $("#available").empty();
                var course = $(this).children("option:selected").val();
                $("#description").hide();
                $("#add").hide();
                $.ajax({
                    type: "POST",
                    url: "{% url 'get_sections' %}",
                    data: {
                        'course': course,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    dataType: 'json',
                    success: function (response) {
                        var sections = response.sections;
                        course_sections = sections;
                        var all_sections = $("#available");
                        all_sections.empty();
                        html = '';
                        
                        var course_description = $("#description");
                        course_description.empty();
                        course_description.append("<p>" + sections[0].description + "</p>");
                        course_description.show();
                        
                        for(var i=0;i,sections.length;i++) {
                            //check if section is online. if so, display "ONLINE" instead of days and time
                            //check if section is full. if so, disable option
                            //check if section is a lab. if so, display "LAB" instead of section number. give option the same value as the lecture section
                            if (sections[i].Cmp == 'DL') {
                                html = '<option value="' + i + '">' + sections[i].Sec + ', ONLINE</option>';
                            } else if (sections[i].Rem == '0') {
                                html = '<option value="' + i + '" disabled>' + sections[i].Sec + ', ' + sections[i].Days + ', ' + sections[i].Time + '</option>';
                            } else if (sections[i].Sec == '\xa0' && sections[i].Title == '\xa0') {
                                html = '<option value="' + i + '" disabled>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LAB' + ', ' + sections[i].Days + ', ' + sections[i].Time + '</option>';
                            } else if (sections[i].Days == '\xa0' && sections[i].Sec != '\xa0') {
                                html = '<option value="' + i + '">' + sections[i].Sec + ', ' + sections[i].Time + '</option>';
                            } else {
                                html = '<option value="' + i + '">' + sections[i].Sec + ', ' + sections[i].Days + ', ' + sections[i].Time + '</option>';
                            }
                            
                            all_sections.append(html);
                        }
                    }
                });
            });
        });

    
        //DISPLAY SELECTED SECTION
       $(document).ready(function() {
            $("#available").change(function() {
                //if there are at least two sections in the course, check if the next section is a lab
                //if it is, send both sections to displaySection
                //if it isn't, send the selected section to displaySection
                //if there is only one section in the course, send the selected section to displaySection
                //make sure selected section is not the last section in #available
                var selected = $("#available").children("option:selected").val();
                var next = $("#available").children("option:selected").next().val();
                if (course_sections.length > 1 && next != undefined) {
                    if (course_sections[next].Sec == '\xa0' && course_sections[next].Title == '\xa0') {
                        displaySection([course_sections[selected], course_sections[next]]);
                    } else {
                        displaySection(course_sections[selected]);
                    }
                } else {
                    displaySection(course_sections[selected]);
                }
            });
        });
    </script>
</head>

<body>
    <nav class = "banner">
        {% include 'navigation.html' %}
        {% comment %} <div id="schedule-dialog" title="Change Color">
            <p style="text-align: center;"><span style="float:left; margin:12px 12px 20px 0;"></span>
                Select a color.</br></br>
                <input type="text" id="color" data-coloris value="rgb(255, 0, 0)" class="coloris"/>
            </p>
        </div> {% endcomment %}
    </nav>

    <header class = "student_info">
        <p id = "reg_status" >Current Status: <span id = "status"></span></p>
        <p id = "student_name"></p>
        <p id = "classification"></p>
    </header>

    <aside class = "options">
        <div id="inner">
        <div id = "pageinfo">
            <h2>Course Registration</h2>
        </div>
        {% csrf_token %}
        <section class = "dropdowns">
            <select id = "select_term"> 
                <option disabled hidden selected>Select Term</option>
                {% comment %} {% for term in terms %}
                <option value="{{term}}">{{term}}</option>
                {% endfor %} {% endcomment %}
            </select>
            <select id = "select_subject">
                <option disabled hidden selected>Select Subject</option>
            </select>
            <select id = "select_course">
                <option disabled hidden selected>Select Course</option>
            </select>
        </section>

        <section id = "description">
            
        </section>

        <section class = "select_section">
            <select id="available" size="5"></select>
        </section>
    

        <div id = "update">
        <button id = "add" onclick="addClass()">Add to Schedule</button>
        <button id = "register">Register</button>
        </div>
    </div>
    </aside>

    <main class = "view">
        <div id = "scheduleview"></div>
    </main>

    <section class = "detailview">
        <table border id="details">
            <thead>
                <tr>
                    <th width = "4%" id = "dv_crn" class = "dv_header">CRN</th>
                    <th width = "11%" id = "dv_section" class = "dv_header">Section</th>
                    <th width = "28%" id = "dv_title" class = "dv_header">Title</th>
                    <th width = "6%" id = "dv_days" class = "dv_header">Days</th>
                    <th width = "13%" id = "dv_time" class = "dv_header">Time</th>
                    <th width = "18%" id = "dv_instructor" class = "dv_header">Instructor</th>
                    <th width = "9%" id = "dv_location" class = "dv_header">Location</th>
                    <th width = "4%" id = "dv_credits" class = "dv_header">Credits</th>
                    <th width = "3%" id = "dv_buttons" class = "dv_header"></th>
                </tr> 
            </thead>
        </table>
    </section>
    <footer class  = "footer">
        <p>Footer</p>
    </footer>
</body>
</html>
